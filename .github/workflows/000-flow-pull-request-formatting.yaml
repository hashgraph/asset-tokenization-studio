name: "000: [FLOW] PR Formatting"
on:
  pull_request_target:
    # This covers: new PRs, title edits, new commits, and assignee changes - everything the workflow actually validates
    types:
      - assigned
      - unassigned
      - opened
      - reopened
      - edited
      - synchronize

defaults:
  run:
    shell: bash

permissions:
  statuses: write

jobs:
  title-check:
    name: Title Check
    runs-on: token-studio-linux-medium
    timeout-minutes: 5
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@a90bcbc6539c36a85cdfeb73f7e2f433735f215b # v2.15.0
        with:
          egress-policy: audit

      - name: Check PR Title
        uses: step-security/action-semantic-pull-request@bc0cf74f5be4ce34accdec1ae908dff38dc5def1 # v6.1.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  assignee-check:
    name: Assignee Check
    runs-on: token-studio-linux-medium
    timeout-minutes: 5
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@a90bcbc6539c36a85cdfeb73f7e2f433735f215b # v2.15.0
        with:
          egress-policy: audit

      - name: Check Assignee
        env:
          ASSIGNEES: ${{ toJSON(github.event.pull_request.assignees) }}
        run: |
          if [[ "${ASSIGNEES}" == "[]" ]] || [[ "${ASSIGNEES}" == "null" ]]; then
            echo "❌ Assignee is not set. At least one assignee is required."
            exit 1
          fi
          echo "✅ Assignees configured."
